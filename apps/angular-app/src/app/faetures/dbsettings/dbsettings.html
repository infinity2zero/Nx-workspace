<div class="settings-container">
  <!-- Header -->
  <div class="settings-header">
    <div class="d-flex align-items-center mb-4">
      <i class="bi bi-gear-fill me-3 header-icon"></i>
      <div>
        <h1 class="mb-1">Settings</h1>
        <p class="text-secondary mb-0">Manage your database configurations and data imports</p>
      </div>
    </div>
  </div>

  <!-- Create New Database Card -->
  <div class="settings-card mb-4">
    <div class="card-header">
      <h3 class="card-title">
        <i class="bi bi-plus-circle me-2"></i>
        Create New Database
      </h3>
      <p class="card-subtitle">Import sites.json and links.json to create a new database</p>
    </div>
    
    <div class="card-body">
      <form (ngSubmit)="uploadAndCreateDatabase()" #createForm="ngForm">
        <!-- Database Name Input -->
        <div class="form-group mb-4">
          <label for="dbName" class="form-label">Database Name</label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-database"></i>
            </span>
            <input 
              type="text" 
              id="dbName"
              class="form-control" 
              [(ngModel)]="newDbName"
              name="dbName"
              placeholder="Enter database name (e.g., my-network-data)"
              required
              [disabled]="uploading">
            <span class="input-group-text">.sqlite</span>
          </div>
        </div>

        <!-- File Upload -->
        <div class="form-group mb-4">
          <label for="fileInput" class="form-label">JSON Files</label>
          <div class="file-upload-area" 
               [class.has-files]="selectedFiles.length > 0"
               [class.uploading]="uploading">
            <input 
              #fileInput
              type="file" 
              id="fileInput"
              class="form-control file-input" 
              multiple
              accept=".json"
              (change)="onFilesSelected($event)"
              [disabled]="uploading">
            
            <div class="file-upload-content">
              <i class="bi bi-upload upload-icon"></i>
              <div class="upload-text">
                <strong>Drop JSON files here or click to browse</strong>
                <small>Select sites.json and links.json files</small>
              </div>
            </div>
          </div>

          <!-- Selected Files Display -->
          <div *ngIf="selectedFiles.length > 0" class="selected-files mt-3">
            <div class="file-item" *ngFor="let file of selectedFiles">
              <div class="file-info">
                <i class="bi bi-file-earmark-text me-2"></i>
                <span class="file-name">{{ file.name }}</span>
                <span class="file-size">({{ formatFileSize(file.size) }})</span>
              </div>
              <div class="file-status">
                <i class="bi bi-check-circle text-success" 
                   *ngIf="file.name.includes('sites') || file.name.includes('links')"></i>
                <i class="bi bi-exclamation-triangle text-warning" 
                   *ngIf="!file.name.includes('sites') && !file.name.includes('links')"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-3">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!newDbName.trim() || selectedFiles.length === 0 || uploading">
            <span *ngIf="uploading" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!uploading" class="bi bi-database-add me-2"></i>
            {{ uploading ? 'Creating Database...' : 'Create Database' }}
          </button>
          
          <button 
            type="button" 
            class="btn btn-outline-secondary"
            (click)="resetForm()"
            [disabled]="uploading">
            <i class="bi bi-arrow-clockwise me-2"></i>
            Reset
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Database Management Card -->
  <div class="settings-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="bi bi-server me-2"></i>
        Database Management
      </h3>
      <p class="card-subtitle">Manage and switch between available databases</p>
    </div>

    <div class="card-body">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-secondary">Loading databases...</p>
      </div>

      <!-- Database List -->
      <div *ngIf="!loading" class="database-list">
        <div *ngIf="databases.length === 0" class="empty-state">
          <i class="bi bi-database-x empty-icon"></i>
          <h4>No databases found</h4>
          <p>Create your first database by uploading JSON files above.</p>
        </div>

        <div *ngFor="let db of databases" class="database-item" [class.active]="db.isActive">
          <div class="database-info">
            <div class="database-header">
              <div class="database-name">
                <i class="bi bi-database-fill me-2"></i>
                <strong>{{ db.name }}</strong>
                <span *ngIf="db.isActive" class="active-badge">ACTIVE</span>
              </div>
              <div class="database-actions">
                <button 
                  *ngIf="!db.isActive" 
                  class="btn btn-sm btn-outline-primary me-2"
                  (click)="switchDatabase(db.name)"
                  [disabled]="loading">
                  <i class="bi bi-arrow-right-circle me-1"></i>
                  Switch
                </button>
                <button 
                  *ngIf="db.isDeletable" 
                  class="btn btn-sm btn-outline-danger"
                  (click)="confirmDelete(db.name)"
                  [disabled]="loading">
                  <i class="bi bi-trash me-1"></i>
                  Delete
                </button>
              </div>
            </div>
            
            <div class="database-stats">
              <div class="stat-item">
                <i class="bi bi-hdd"></i>
                <span>{{ formatFileSize(db.size) }}</span>
              </div>
              <div class="stat-item" *ngIf="db.siteCount !== undefined">
                <i class="bi bi-geo-alt"></i>
                <span>{{ db.siteCount }} sites</span>
              </div>
              <div class="stat-item" *ngIf="db.linkCount !== undefined">
                <i class="bi bi-diagram-3"></i>
                <span>{{ db.linkCount }} links</span>
              </div>
              <div class="stat-item">
                <i class="bi bi-calendar"></i>
                <span>{{ formatDate(db.created) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<ng-template #confirmModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Confirm Deletion</h4>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="alert alert-warning">
      <i class="bi bi-exclamation-triangle me-2"></i>
      Are you sure you want to delete <strong>{{ deleteTarget }}</strong>?
    </div>
    <p>This action cannot be undone. All data in this database will be permanently lost.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-danger" (click)="deleteDatabase()">
      <i class="bi bi-trash me-2"></i>
      Delete Database
    </button>
  </div>
</ng-template>

<div class="card">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-filter text-primary me-2"></i>
            Network Filters
        </h6>
    </div>
    <div class="card-body">
        <form [formGroup]="filterForm">
            <!-- Geographic Filters -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-globe text-success me-1"></i>
                    Countries
                </label>
                <ng-select formControlName="country" [items]="availableCountries" [multiple]="true" [clearable]="true"
                    placeholder="Select countries..." (change)="onFilterChange()">
                </ng-select>
            </div>

            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-city text-info me-1"></i>
                    Cities
                </label>
                <ng-select formControlName="city" [items]="availableCities" [multiple]="true" [clearable]="true"
                    placeholder="Select cities..." [loading]="loadingCities" (change)="onFilterChange()">
                </ng-select>
            </div>

            <!-- Technology Filters -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-network-wired text-warning me-1"></i>
                    Platform Types
                </label>
                <div class="btn-group-vertical w-100" role="group">
                    <input type="checkbox" class="btn-check" formControlName="includeFiber" id="fiber"
                        (change)="onPlatformChange()">
                    <label class="btn btn-outline-success btn-sm" for="fiber">
                        <i class="fas fa-bolt me-1"></i>
                        Fiber
                    </label>

                    <input type="checkbox" class="btn-check" formControlName="includeWireless" id="wireless"
                        (change)="onPlatformChange()">
                    <label class="btn btn-outline-warning btn-sm" for="wireless">
                        <i class="fas fa-wifi me-1"></i>
                        Wireless
                    </label>

                    <input type="checkbox" class="btn-check" formControlName="includeSatellite" id="satellite"
                        (change)="onPlatformChange()">
                    <label class="btn btn-outline-info btn-sm" for="satellite">
                        <i class="fas fa-satellite me-1"></i>
                        Satellite
                    </label>

                    <input type="checkbox" class="btn-check" formControlName="includeMicrowave" id="microwave"
                        (change)="onPlatformChange()">
                    <label class="btn btn-outline-secondary btn-sm" for="microwave">
                        <i class="fas fa-broadcast-tower me-1"></i>
                        Microwave
                    </label>
                </div>
            </div>

            <!-- Network Tiers -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-layer-group text-purple me-1"></i>
                    Network Tiers
                </label>
                <ng-select formControlName="network" [items]="availableNetworks" [multiple]="true" [clearable]="true"
                    placeholder="Select network tiers..." (change)="onFilterChange()">
                </ng-select>
            </div>

            <!-- Distance Filters -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-ruler text-primary me-1"></i>
                    Link Distance Range (km)
                </label>
                <div class="row g-2">
                    <div class="col-6">
                        <input type="number" class="form-control form-control-sm" formControlName="minDistance"
                            placeholder="Min" min="0" (input)="onRangeChange()">
                    </div>
                    <div class="col-6">
                        <input type="number" class="form-control form-control-sm" formControlName="maxDistance"
                            placeholder="Max" min="0" (input)="onRangeChange()">
                    </div>
                </div>
                <div class="form-text">
                    Current: {{ currentDistanceRange }}
                </div>
            </div>

            <!-- Exclusion Filters -->
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">
                        <i class="fas fa-ban text-danger me-1"></i>
                        Exclusions
                    </label>
                    <button type="button" class="btn btn-sm btn-outline-secondary" (click)="toggleExclusions()">
                        <i class="fas" [class.fa-chevron-up]="showExclusions"
                            [class.fa-chevron-down]="!showExclusions"></i>
                    </button>
                </div>

                <div [ngbCollapse]="!showExclusions">
                    <div class="mb-2">
                        <label class="form-label form-label-sm">Exclude Sites</label>
                        <textarea class="form-control form-control-sm" formControlName="excludeNodes" rows="2"
                            placeholder="Enter site IDs, separated by commas" (input)="onExcludeNodesChange()">
                </textarea>
                    </div>

                    <div class="mb-2">
                        <label class="form-label form-label-sm">Exclude Links</label>
                        <textarea class="form-control form-control-sm" formControlName="excludeLinks" rows="2"
                            placeholder="Enter link IDs, separated by commas" (input)="onExcludeLinksChange()">
                </textarea>
                    </div>
                </div>
            </div>

            <!-- Advanced Options -->
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">
                        <i class="fas fa-cogs text-secondary me-1"></i>
                        Advanced Options
                    </label>
                    <button type="button" class="btn btn-sm btn-outline-secondary" (click)="toggleAdvanced()">
                        <i class="fas" [class.fa-chevron-up]="showAdvanced" [class.fa-chevron-down]="!showAdvanced"></i>
                    </button>
                </div>

                <div [ngbCollapse]="!showAdvanced">
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" formControlName="allowBackups" id="allowBackups"
                            (change)="onFilterChange()">
                        <label class="form-check-label" for="allowBackups">
                            Include backup routes
                        </label>
                    </div>

                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" formControlName="preferReliable"
                            id="preferReliable" (change)="onFilterChange()">
                        <label class="form-check-label" for="preferReliable">
                            Prefer reliable connections
                        </label>
                    </div>

                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" formControlName="avoidCongested"
                            id="avoidCongested" (change)="onFilterChange()">
                        <label class="form-check-label" for="avoidCongested">
                            Avoid congested links
                        </label>
                    </div>
                </div>
            </div>

            <!-- Quick Presets -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="fas fa-magic text-purple me-1"></i>
                    Quick Presets
                </label>
                <div class="btn-group w-100 mb-2" role="group">
                    <button type="button" class="btn btn-outline-primary btn-sm" (click)="applyPreset('fastest')">
                        <i class="fas fa-tachometer-alt me-1"></i>
                        Fastest
                    </button>
                    <button type="button" class="btn btn-outline-success btn-sm" (click)="applyPreset('reliable')">
                        <i class="fas fa-shield-alt me-1"></i>
                        Reliable
                    </button>
                    <button type="button" class="btn btn-outline-info btn-sm" (click)="applyPreset('redundant')">
                        <i class="fas fa-clone me-1"></i>
                        Redundant
                    </button>
                </div>
            </div>
        </form>

        <!-- Filter Summary -->
        <div class="alert alert-light p-2" *ngIf="hasActiveFilters">
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    {{ getFilterSummary() }}
                </small>
                <button class="btn btn-sm btn-outline-danger" (click)="clearAllFilters()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
</div>